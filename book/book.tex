%!TEX program = xelatex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% book template
%% WisdomFusion@gmail.com
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper,twoside]{ctexbook}
\usepackage{fontspec}
\usepackage{xunicode}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{enumerate}
%% \usepackage{amsmath,mathrsfs,amsfonts}
\usepackage[x11names]{xcolor}
\usepackage{titletoc}
\usepackage[clearempty]{titlesec}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{colortbl}
\usepackage{multirow,makecell}
\usepackage{ulem} % \uline
\usepackage{multicol}
\usepackage{lipsum}

\usepackage{hyperref}
\hypersetup{
  bookmarksnumbered,
  colorlinks,
  linkcolor={magenta},
  citecolor={magenta},
  urlcolor={teal}
}

\linespread{1.3}

\geometry{
  textwidth=138mm,
  textheight=215mm,
  %% left=27mm,
  %% or
  inner=23mm,
  %% right=27mm,
  %% or
  outer=18mm,
  top=25.4mm, bottom=25.4mm,
  headheight=2.17cm,
  headsep=4mm,
  footskip=12mm
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% fonts settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% \usepackage{ebgaramond}

\setmainfont[Ligatures=TeX]{Minion Pro}
\setsansfont{Myriad Pro}
\setmonofont{Inconsolata}

\setCJKmainfont[BoldFont={方正小标宋_GBK}, ItalicFont={方正楷体_GBK}, BoldItalicFont={方正仿宋_GBK}]{方正书宋_GBK}
\setCJKsansfont{方正黑体_GBK}
\setCJKmonofont{方正中等线_GBK}

\XeTeXlinebreaklocale "zh"
\XeTeXlinebreakskip = 0pt plus 1pt

\newfontfamily\fzss{方正书宋_GBK}
\newfontfamily\fzxbs{方正小标宋_GBK}
\newfontfamily\fzhei{方正黑体_GBK}
\newfontfamily\fzkai{方正楷体_GBK}
\newfontfamily\fzfs{方正仿宋_GBK}
\newfontfamily\fzzdx{方正中等线_GBK}

\newfontfamily\garamond{Adobe Garamond Pro}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% titlesec
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\titleformat
{\chapter} % command
[display] % shape
{\bfseries\Large} % format
{
  \rule{\textwidth}{0.5pt}
  \flushright
  \zihao{-4}
  第 \thechapter 章
} % label
{1ex} % sep
{
  \vspace{5ex}
  \flushright
  \zihao{3}
} % before-code
[
\vspace{-0.5ex}%
\rule{\textwidth}{1pt}
] % after-code

\titleformat{\section}[hang]{\rmfamily}
{\centering\zihao{-3}\bfseries\thesection\enspace}{1pt}{\zihao{-3}\bfseries}

\titleformat{\subsection}[hang]{\rmfamily}
{\zihao{-4}\bfseries\thesubsection\enspace}{1pt}{\zihao{4}\bfseries\filright}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 中文结构
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% 去除部分页页码，不需要请注释
%% \makeatletter
%% \renewcommand\part{%
%%   \if@openright
%%     \cleardoublepage
%%   \else
%%     \clearpage
%%   \fi
%%   \thispagestyle{empty}%
%%   \if@twocolumn
%%     \onecolumn
%%     \@tempswatrue
%%   \else
%%     \@tempswafalse
%%   \fi
%%   \null\vfil
%%   \secdef\@part\@spart
%% }
%% \makeatother

\renewcommand{\contentsname}{目\hspace{1em}录}
\renewcommand{\figurename}{图}
\renewcommand{\tablename}{表}
\renewcommand{\partname}{部分}
\renewcommand{\listfigurename}{\bfseries 插图目录}
\renewcommand{\listtablename}{\bfseries 表格目录}
\renewcommand{\bibname}{\bfseries 参考文献}
\renewcommand{\appendixname}{\bfseries 附\hspace{2em}录}
\renewcommand{\indexname}{\bfseries 索\hspace{2em}引}


%% 解决目录文字重叠
\makeatletter
\renewcommand{\numberline}[1]{%
\settowidth\@tempdimb{#1\hspace{0.5em}}%
\ifdim\@tempdima<\@tempdimb%
  \@tempdima=\@tempdimb%
\fi%
\hb@xt@\@tempdima{\@cftbsnum #1\@cftasnum\hfil}\@cftasnumb}
\makeatother


\begin{document}

%% title page
\begin{titlepage}
  \centering
  \vspace*{25ex}
  {\zihao{1} \textbf{Book Title 中文书名} \par}
  \vspace{10ex}
  {\zihao{4} \textit{胡志飞}\quad{}编著 \par}
  \vfill
  {\zihao{4}\ 北京\ $\bullet$\ BEIJING}
\end{titlepage}
\thispagestyle{empty}


\frontmatter

\chapter*{序}
\addcontentsline{toc}{chapter}{序}

本书作序。



\chapter*{前言}
\addcontentsline{toc}{chapter}{前言}

本书前言。


{
  \hypersetup{hidelinks}
  \tableofcontents
}



\mainmatter


\part{中文的部分标题}

\chapter{中文的章标题}

\hspace{.15\linewidth}\begin{minipage}[H]{.7\linewidth}
{
  \hypersetup{hidelinks}
  \startcontents[chapters]
  \printcontents[chapters]{}{1}{\contentsmargin{1em}\setcounter{tocdepth}{1}}
}
\end{minipage}
\vspace{10ex}

\lipsum[3]

\clearpage

\section{中文的节标题}

\lipsum[3-5]

\subsection{subsection 小节}

中文\textbf{字体}测试。测试\textbf{中文和\textit{English字体样式}}。

{\fzfs 仿宋}

\subsection{subsection 小节2}


\section{English section title}

\lipsum[2-5]

\chapter{English chapter title}

\hspace{.15\linewidth}\begin{minipage}[H]{.7\linewidth}
{
  \hypersetup{hidelinks}
  \startcontents[chapters]
  \printcontents[chapters]{}{1}{\contentsmargin{1em}\setcounter{tocdepth}{1}}
}
\end{minipage}
\vspace{10ex}

\lipsum[3]

\clearpage

\section{再来一个小节}

该小节的内容。


\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
